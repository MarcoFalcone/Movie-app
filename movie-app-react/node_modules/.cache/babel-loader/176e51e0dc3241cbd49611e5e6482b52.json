{"ast":null,"code":"import _regeneratorRuntime from\"/home/markrius/Desktop/React-movie-app/front/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/markrius/Desktop/React-movie-app/front/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/markrius/Desktop/React-movie-app/front/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";/* eslint-disable react/no-unknown-property */import React,{useContext,useEffect,useState}from'react';import{useDetectClickOutside}from'react-detect-click-outside';import{useHistory}from'react-router-dom';import{Context}from'..';import'../styles/Detail.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var DetailMovie=function DetailMovie(){var _useContext=useContext(Context),apiKey=_useContext.apiKey;var history=useHistory();var _history$location$sta=history.location.state,poster=_history$location$sta.poster,overview=_history$location$sta.overview,vote=_history$location$sta.vote,date=_history$location$sta.date,title=_history$location$sta.title,id=_history$location$sta.id;var _useState=useState(''),_useState2=_slicedToArray(_useState,2),trailer=_useState2[0],setTrailer=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),watchTrailer=_useState4[0],setWatchTrailer=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),favorites=_useState6[0],setFavorites=_useState6[1];var addFavorite=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var requestOptions;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:requestOptions={method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({poster_path:poster,overview:overview,vote_average:vote,release_date:date,title:title,id:id})};_context.next=3;return fetch('/api/movies/favorites',requestOptions);case 3:case\"end\":return _context.stop();}}},_callee);}));return function addFavorite(){return _ref.apply(this,arguments);};}();var removeFavorite=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var requestOptions;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:requestOptions={method:'DELETE'};_context2.next=3;return fetch(\"/api/movies/favorites/\".concat(id),requestOptions);case 3:case\"end\":return _context2.stop();}}},_callee2);}));return function removeFavorite(){return _ref2.apply(this,arguments);};}();var getFavorites=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){var res,resJson;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return fetch('/api/movies/favorites');case 2:res=_context3.sent;_context3.next=5;return res.json();case 5:resJson=_context3.sent;setFavorites(resJson);case 7:case\"end\":return _context3.stop();}}},_callee3);}));return function getFavorites(){return _ref3.apply(this,arguments);};}();var getTrailer=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(){var urlVideos,response,responseJson,_responseJson$results,objTrailer;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:urlVideos=\"https://api.themoviedb.org/3/movie/\".concat(id,\"/videos?api_key=\").concat(apiKey,\"&language=en-US\");_context4.next=3;return fetch(urlVideos);case 3:response=_context4.sent;_context4.next=6;return response.json();case 6:responseJson=_context4.sent;if(responseJson!==null&&responseJson!==void 0&&responseJson.results){objTrailer=responseJson===null||responseJson===void 0?void 0:(_responseJson$results=responseJson.results)===null||_responseJson$results===void 0?void 0:_responseJson$results.find(function(obj){return obj.type==='Trailer';});if(objTrailer)setTrailer(objTrailer===null||objTrailer===void 0?void 0:objTrailer.key);}case 8:case\"end\":return _context4.stop();}}},_callee4);}));return function getTrailer(){return _ref4.apply(this,arguments);};}();var isMovieInFavorites=favorites.some(function(movie){return(movie===null||movie===void 0?void 0:movie.id)===id;});var ModalTrailer=function ModalTrailer(){var ref=useDetectClickOutside({onTriggered:function onTriggered(){return setWatchTrailer(false);}});return/*#__PURE__*/_jsxs(\"div\",{className:\"trailerWrapper\",children:[/*#__PURE__*/_jsx(\"p\",{onClick:function onClick(){return setWatchTrailer(false);},className:\"closeTrailer\",children:\"CLOSE \\u2716\"}),/*#__PURE__*/_jsx(\"iframe\",{ref:ref,title:\"trailer\",className:\"trailerFrame\",src:\"https://www.youtube.com/embed/\".concat(trailer),type:\"video/mp4\",controls:true,allowFullScreen:\"allowfullscreen\",mozallowfullscreen:\"mozallowfullscreen\",msallowfullscreen:\"msallowfullscreen\",oallowfullscreen:\"oallowfullscreen\",webkitallowfullscreen:\"webkitallowfullscreen\"})]});};useEffect(function(){getTrailer();getFavorites();},[]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"detailWrapper\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"info\",children:[/*#__PURE__*/_jsx(\"img\",{className:\"detailPoster\",src:poster,alt:\"\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{style:{fontSize:'30px',marginBottom:'100px'},children:title}),/*#__PURE__*/_jsx(\"p\",{style:{fontSize:'30px'},children:date}),/*#__PURE__*/_jsx(\"p\",{children:overview}),/*#__PURE__*/_jsxs(\"span\",{style:{fontSize:'30px'},children:[vote,\"\\u2605\"]}),trailer?/*#__PURE__*/_jsx(\"p\",{onClick:function onClick(){return setWatchTrailer(true);},className:\"detailAction\",children:\"Watch Trailer \\u25BA\"}):null,isMovieInFavorites?/*#__PURE__*/_jsx(\"p\",{onClick:function onClick(){return removeFavorite();},className:\"detailAction\",children:\"Remove from favorites +\"}):/*#__PURE__*/_jsx(\"p\",{onClick:function onClick(){return addFavorite();},className:\"detailAction\",children:\"Add to favorites +\"})]})]})}),watchTrailer?/*#__PURE__*/_jsx(ModalTrailer,{}):null]});};export default DetailMovie;","map":{"version":3,"names":["React","useContext","useEffect","useState","useDetectClickOutside","useHistory","Context","DetailMovie","apiKey","history","location","state","poster","overview","vote","date","title","id","trailer","setTrailer","watchTrailer","setWatchTrailer","favorites","setFavorites","addFavorite","requestOptions","method","headers","body","JSON","stringify","poster_path","vote_average","release_date","fetch","removeFavorite","getFavorites","res","json","resJson","getTrailer","urlVideos","response","responseJson","results","objTrailer","find","obj","type","key","isMovieInFavorites","some","movie","ModalTrailer","ref","onTriggered","fontSize","marginBottom"],"sources":["/home/markrius/Desktop/React-movie-app/front/src/views/DetailMovie.jsx"],"sourcesContent":["/* eslint-disable react/no-unknown-property */\nimport React, { useContext, useEffect, useState } from 'react';\nimport { useDetectClickOutside } from 'react-detect-click-outside';\nimport { useHistory } from 'react-router-dom';\nimport { Context } from '..';\n\nimport '../styles/Detail.css';\n\nconst DetailMovie = () => {\n  const { apiKey } = useContext(Context);\n  const history = useHistory();\n  \n  const {\n    poster, overview, vote, date, title, id\n  } = history.location.state;\n  \n  const [trailer, setTrailer] = useState('');\n  const [watchTrailer, setWatchTrailer] = useState(false);\n  const [favorites, setFavorites] = useState([]);\n\n  const addFavorite = async () => {\n    const requestOptions = {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        poster_path: poster,\n        overview,\n        vote_average: vote,\n        release_date: date,\n        title,\n        id\n      })\n    };\n    await fetch('/api/movies/favorites', requestOptions);\n  };\n\n  const removeFavorite = async () => {\n    const requestOptions = {\n      method: 'DELETE',\n    };\n    await fetch(`/api/movies/favorites/${id}`, requestOptions);\n  };\n\n  const getFavorites = async () => {\n    const res = await fetch('/api/movies/favorites');\n    const resJson = await res.json();\n    setFavorites(resJson);\n  };\n  \n  const getTrailer = async () => {\n    const urlVideos = `https://api.themoviedb.org/3/movie/${id}/videos?api_key=${apiKey}&language=en-US`;\n    const response = await fetch(urlVideos);\n    const responseJson = await response.json();\n    if (responseJson?.results) {\n      const objTrailer = responseJson?.results?.find((obj) => obj.type === 'Trailer');\n      if (objTrailer) setTrailer(objTrailer?.key);\n    }\n  };\n\n  const isMovieInFavorites = favorites.some((movie) => movie?.id === id);\n\n  \n  const ModalTrailer = () => {\n    const ref = useDetectClickOutside({ onTriggered: () => setWatchTrailer(false) });\n\n    return (\n      <div className=\"trailerWrapper\">\n        <p onClick={() => setWatchTrailer(false)} className=\"closeTrailer\">CLOSE &#10006;</p>\n        <iframe\n          ref={ref}\n          title=\"trailer\"\n          className=\"trailerFrame\"\n          src={`https://www.youtube.com/embed/${trailer}`}\n          type=\"video/mp4\"\n          controls\n          allowFullScreen=\"allowfullscreen\"\n          mozallowfullscreen=\"mozallowfullscreen\"\n          msallowfullscreen=\"msallowfullscreen\"\n          oallowfullscreen=\"oallowfullscreen\"\n          webkitallowfullscreen=\"webkitallowfullscreen\" />\n      </div>\n    );\n  };\n\n  useEffect(() => {\n    getTrailer();\n    getFavorites();\n  }, []);\n\n  return (\n    <>\n      <div className='detailWrapper'>\n        <div className=\"info\">\n          <img className=\"detailPoster\" src={poster} alt='' />\n          <div>\n            <p style={{ fontSize: '30px', marginBottom: '100px' }}>{title}</p>\n            <p style={{ fontSize: '30px' }}>{date}</p>\n            <p>{overview}</p>\n            <span style={{ fontSize: '30px' }}>{vote}&#x2605;</span>\n            {trailer ? <p onClick={() => setWatchTrailer(true)} className='detailAction'>Watch Trailer &#9658;</p> : null}\n            {isMovieInFavorites ? (\n              <p onClick={() => removeFavorite()} className='detailAction'>Remove from favorites &#x2b;</p>\n            ) : (\n              <p onClick={() => addFavorite()} className='detailAction'>Add to favorites &#x2b;</p>\n            )}\n          </div>\n        </div>\n      </div>\n      {watchTrailer ? (\n        <ModalTrailer />\n      ) : null}\n    </>\n  );\n};\n\nexport default DetailMovie;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}